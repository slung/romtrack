(function(a){var b=new Class({$events:null,init:function(){this.$events={};},on:function(c,d){this.$events[c]=this.$events[c]||[];this.$events[c].push(d);},fire:function(c,g){var f=this.$events[c];if(f){for(var d in f){var e=f[d];e.apply(this,[g]);}}},detach:function(c,f){var e=this.$events[c];for(var d=0;d<e.length;d++){if(e[d]==f){delete e[d];return;}}return;}});a.EventManager=b;}(TRACKS));(function(b){var a=null;var c=b.EventManager.extend({dir:"languages",extension:".js",init:function(d){if(a){throw new Error("You can only create one instance of LanguageManager!");}this._parent();},loadLanguage:function(f,e){var d=this.dir+"/"+f+this.extension;JSONP.get(d,{},b.bind(function(g){this.dictionary=g;if(e){e.call(this,[g]);}},this));return;}});c.getInstance=function(){if(a){return a;}a=new c();return a;};b.LanguageManager=c;}(TRACKS));(function(b){var a=b.EventManager.extend({init:function(){this._parent();},onMessage:function(d,c){b.dispatcher.on(d,b.bind(c,this));},sendMessage:function(d,c){b.dispatcher.fire(d,c);}});b.MsgManager=a;b.dispatcher=new a();}(TRACKS));(function(b){var a=null;var c=b.EventManager.extend({tableName:"",poiFilterActive:true,trackFilterActive:true,privateMode:false,rowCount:20,cluster:null,googleApiKey:"AIzaSyBR8BAjYqkuL8i1Qzu1SJvaZYuL932NCAg",fusionTableId:"1cr4YhI1ZpenusSDOGh20HH0RSbHFT7G5LDH-r94O",pois:[],tracks:[],tables:[],init:function(d){if(a){throw new Error("You can only create one instance of DataManager!");}this._parent();this.ajax=b.AjaxManager.getInstance();},geocode:function(d,g,h,e){var e=e||{};var f=new google.maps.Geocoder();f.geocode({address:d,region:g},b.bind(function(o,n){if(n==google.maps.GeocoderStatus.OK){if(h){var m=[];var q=-1;for(var p=0;p<o.length;p++){q++;m.push({index:q,lat:o[p].geometry.location.lat(),lon:o[p].geometry.location.lng(),address:o[p].formatted_address,bounds:[o[p].geometry.viewport.getSouthWest().lat(),o[p].geometry.viewport.getSouthWest().lng(),o[p].geometry.viewport.getNorthEast().lat(),o[p].geometry.viewport.getNorthEast().lng()]});}if(e.success){e.success.apply(this,[m]);}}else{var r=o[0].geometry.location.lat();var k=o[0].geometry.location.lng();var l=o[0].formatted_address;var j=[o[0].geometry.viewport.getSouthWest().lat(),o[0].geometry.viewport.getSouthWest().lng(),o[0].geometry.viewport.getNorthEast().lat(),o[0].geometry.viewport.getNorthEast().lng()];if(e.success){e.success.apply(this,[r,k,l,j]);}}}},this));},reverseGeocode:function(h,e,d){var d=d||{};var g=new google.maps.Geocoder();var f=new google.maps.LatLng(h,e);g.geocode({latLng:f},b.bind(function(k,j){if(j==google.maps.GeocoderStatus.OK){var i=k[0].formatted_address;var l=k[0].geometry.viewport;if(d.success){d.success.apply(this,[i,l]);}}},this));},geolocateUser:function(){if(navigator.geolocation){b.mask(b.MASK_ELEMENT);navigator.geolocation.getCurrentPosition(b.bind(function(d){this.reverseGeocode(d.coords.latitude,d.coords.longitude,{success:b.bind(function(e,f){this.geocodeBounds=[f.getSouthWest().lat(),f.getSouthWest().lng(),f.getNorthEast().lat(),f.getNorthEast().lng()];this.geocodeCenter=[d.coords.latitude,d.coords.longitude];var g={lat:d.coords.latitude,lon:d.coords.longitude,address:e,bounds:this.geocodeBounds};this.geocodedLocation=g;b.unmask(b.MASK_ELEMENT);this.fire("changeState",{state:b.App.States.DEFAULT});this.fire("userGeocoded",g);},this)});},this),b.bind(function(d){this.geocodedLocation=null;b.unmask(b.MASK_ELEMENT);this.fire("userNotGeocoded");},this));}},search:function(e,d){var f=null;this.location=e?e:this.location;this.searchRadius=d?d:this.searchRadius;if(!this.location){if(this.poiFilterActive&&this.trackFilterActive){return this.pois.concat(this.tracks);}else{if(this.trackFilterActive){return this.tracks;}else{if(this.poiFilterActive){return this.pois;}}}}else{if(this.poiFilterActive&&this.trackFilterActive){f=b.GeoOperations.getInstance().getDataInBounds(this.tracks,this.location,this.searchRadius);f.concat(b.GeoOperations.getInstance().getDataInBounds(this.pois,this.location,this.searchRadius));return f;}else{if(this.trackFilterActive){f=b.GeoOperations.getInstance().getDataInBounds(this.tracks,this.location,this.searchRadius);return f;}else{if(this.poiFilterActive){f=b.GeoOperations.getInstance().getDataInBounds(this.pois,this.location,this.searchRadius);return f;}}}}return null;},getDataFromDataSource:function(){if(this.poiFilterActive&&this.trackFilterActive){this.getPoisFromDataSource();this.getTracksFromDataSource();}else{if(this.trackFilterActive){this.getTracksFromDataSource();}else{if(this.poiFilterActive){this.getPoisFromDataSource();}}}},getPoisFromDataSource:function(){var d="https://www.googleapis.com/fusiontables/v2/query";this.pois=[];d+="?key="+this.googleApiKey;d+="&sql="+this.buildSelectStatement();d+=this.buildWhereClause([{column:"type",operator:"=",value:"'poi'",connective:"AND"},{column:"private",operator:(this.privateMode===true)?"=":"NOT EQUAL TO",value:"'true'"}]);jQuery.ajax({url:d,type:"GET",crossDomain:true,success:b.bind(function(j){var h=j.rows;if(!h||h.length===0){b.dispatcher.fire("poisLoaded");return;}for(var g=0;g<h.length;g++){var l=h[g];var e=(this.app.language=="en")?l[2]:l[1];var f=(this.app.language=="en")?l[4]:l[3];var k=new b.POI(l[0],e,l[8],l[9],f,l[5]);this.pois.push(k);if(g===h.length-1){b.dispatcher.fire("poisLoaded");}}},this)});},getTracksFromDataSource:function(f,e){var d="https://www.googleapis.com/fusiontables/v2/query";this.tracks=[];d+="?key="+this.googleApiKey;d+="&sql="+this.buildSelectStatement();d+=this.buildWhereClause([{column:"type",operator:"=",value:"'track'",connective:"AND"},{column:"private",operator:(this.privateMode===true)?"=":"NOT EQUAL TO",value:"'true'"}]);jQuery.ajax({url:d,type:"GET",crossDomain:true,success:b.bind(function(j){var h=j.rows;if(!h||h.length===0){b.dispatcher.fire("tracksLoaded");return;}this.expectedNbOfTracks=j.rows.length;for(var g=0;g<h.length;g++){this.extractTrackData(h[g]);}},this)});},getDataById:function(e){for(var d=0;d<this.tracks.length;
d++){if(this.tracks[d].id===e){return this.tracks[d];}}for(var d=0;d<this.pois.length;d++){if(this.pois[d].id===e){return this.pois[d];}}return null;},extractTrackData:function(d){jQuery.ajax({url:d[7],type:"GET",dataType:"xml",crossDomain:true,success:b.bind(function(f){var g=this.trackPointsFromGPX(f);var e=(this.app.language=="en")?d[2]:d[1];var h=(this.app.language=="en")?d[4]:d[3];this.saveTrack(d[0],e,d[7],h,d[5],g.trackPoints,g.elevationPoints);},this)});},saveTrack:function(k,f,e,i,h,j,g){var d=new b.Track(k,f,e,i,h,j,g);this.tracks.push(d);if(this.tracks.length===this.expectedNbOfTracks){b.dispatcher.fire("tracksLoaded");}},trackPointsFromGPX:function(d){var g=[];var e=[];var f=null;if(jQuery(d).find("rtept").length>0){f="rtept";}else{if(jQuery(d).find("wpt").length>0){f="wpt";}else{if(jQuery(d).find("trkpt").length>0){f="trkpt";}}}jQuery(d).find(f).each(function(){var k=jQuery(this).attr("lat");var i=jQuery(this).attr("lon");var j=new google.maps.LatLng(k,i);var h=jQuery(this).children("ele").text();g.push(j);if(h!="0"){e.push(parseInt(h));}});return{trackPoints:g,elevationPoints:e};},buildSelectStatement:function(){return"SELECT * FROM "+this.fusionTableId;},buildWhereClause:function(f){var g=0,e=null,d=" WHERE ";if(!f||f.length===0){return;}for(g=0;g<f.length;g++){e=f[g].connective?" "+f[g].connective+" ":"";d+=f[g].column+" "+f[g].operator+" "+f[g].value+e;}return d;}});c.getInstance=function(){if(a){return a;}a=new c();return a;};b.DataManager=c;}(TRACKS));(function(a){var b=null;var c=new Class({restApiUrl:"http://localhost:1314/",getTracks:function(f,e){var d=this.geoAdsPlatformUrl+"ads";jQuery.ajax({url:d,type:"POST",success:a.bind(function(g){if(g.GreatSuccess==false){e.apply(this,[]);}else{f.apply(this,[a.JSON.parse(g)]);}},this)});}});c.getInstance=function(){if(b){return b;}b=new c();return b;};a.AjaxManager=c;})(TRACKS);(function(a){var b=function(e,c,d,i,h,l,j,g,f,m){this.id=e;this.name=c;this.url=d;this.article=i;this.preview=h;this.points=l;this.elevationPoints=j||[];this.color=g||"#D95642";this.startMarkerUrl=f||"assets/images/marker.png";this.endMarkerUrl=m||"assets/images/end-marker.png";this.bounds=this.getBounds();this.mapTrack=this.getMapTrack();this.length=this.getLength();var k=this.getTotalAscentDescent();this.ascent=k.ascent;this.descent=k.descent;};b.prototype={hasElevationProfile:function(){return(this.elevationPoints.length>0&&this.elevationPoints.length==this.points.length);},getBounds:function(){var d=new google.maps.LatLngBounds();for(var c=0;c<this.points.length;c++){d.extend(this.points[c]);}return d;},getStartTrackPoint:function(){return this.points[0];},getEndTrackPoint:function(){return this.points[this.points.length-1];},getMapTrack:function(){var c=new google.maps.Polyline({path:this.points,strokeColor:this.color,strokeOpacity:0.7,strokeWeight:4});google.maps.event.addListener(c,"mouseover",function(){this.setOptions({strokeOpacity:1});});google.maps.event.addListener(c,"mouseout",function(){this.setOptions({strokeOpacity:0.7});});return c;},getLength:function(){var c=google.maps.geometry.spherical.computeLength(this.points);c=c/1000;c=Math.round(c);return c;},getDistanceFromStart:function(c){var d=google.maps.geometry.spherical.computeLength(this.points.slice(0,c));d=(d/1000).toFixed(2);return parseFloat(d);},getTotalAscentDescent:function(){if(!this.hasElevationProfile()){return null;}var c=0;var e=0;for(var d=0;d<this.elevationPoints.length-1;d++){if(this.elevationPoints[d]<this.elevationPoints[d+1]){c+=this.elevationPoints[d+1]-this.elevationPoints[d];}else{if(this.elevationPoints[d]>this.elevationPoints[d+1]){e+=this.elevationPoints[d]-this.elevationPoints[d+1];}}}return{ascent:Math.round(c),descent:Math.round(e)};}};a.Track=b;})(TRACKS);(function(a){var b=function(j,d,i,f,h,g,c,e){this.id=j;this.name=d;this.latitude=i;this.longitude=f;this.point=new google.maps.LatLng(i,f);this.article=h;this.preview=g;this.index=c;this.startMarkerUrl=e||"assets/images/poi-marker.png";};b.prototype={};a.POI=b;})(TRACKS);(function(a){Number.prototype.toRad=function(){return this*Math.PI/180;};Number.prototype.toDeg=function(){return this*180/Math.PI;};var b=null;var c=new Class({getPointAtDistanceFromPoint:function(d,e,j){j=j/6371;e=e.toRad();var i=d.lat().toRad(),g=d.lng().toRad();var h=Math.asin(Math.sin(i)*Math.cos(j)+Math.cos(i)*Math.sin(j)*Math.cos(e));var f=g+Math.atan2(Math.sin(e)*Math.sin(j)*Math.cos(i),Math.cos(j)-Math.sin(i)*Math.sin(h));if(isNaN(h)||isNaN(f)){return null;}return new google.maps.LatLng(h.toDeg(),f.toDeg());},getDataInBounds:function(k,o,l){var d=null,h=null,f=null,e=[],g=null,m=null,n=null,l=l?l:0;if(!k||!o||k.length==0){return;}a.mask(a.MASK_ELEMENT);d=new google.maps.LatLng(o.lat,o.lon);h=new google.maps.LatLngBounds(new google.maps.LatLng(o.bounds[0],o.bounds[1]),new google.maps.LatLng(o.bounds[2],o.bounds[3]));g=this.getPointAtDistanceFromPoint(d,45,l);m=this.getPointAtDistanceFromPoint(d,135,l);n=this.getPointAtDistanceFromPoint(d,245,l);f=new google.maps.LatLngBounds(n,g);f.extend(m);for(var j=0;j<k.length;j++){if(k[j] instanceof a.Track){if(f.contains(k[j].points[0])||f.contains(k[j].points[k[j].points.length-1])){e.push(k[j]);}}else{if(f.contains(k[j].point)){e.push(k[j]);}}}a.unmask(a.MASK_ELEMENT);return e;},getDataBounds:function(f){var e=new google.maps.LatLngBounds();for(var d=0;d<f.length;d++){if(f[d] instanceof a.Track){e.extend(f[d].getStartTrackPoint());}else{e.extend(f[d].point);}}return e;}});c.getInstance=function(){if(b){return b;}b=new c();return b;};a.GeoOperations=c;})(TRACKS);(function(a){var b=a.MsgManager.extend({app:null,mustache:null,templates:null,init:function(c){this.mustache=a.mustache;this.templates=c.templates;this.container=c.container;this.renderContainer=c.renderContainer;this.hideOnStates=c.hideOnStates||[];this.formatRenderData=c.formatRenderData;this.dataManager=a.DataManager.getInstance();this.geoOperations=a.GeoOperations.getInstance();this.ajax=a.AjaxManager.getInstance();this.events=a.extend(this.events||{},c.events||{});
this.parseEvents();this.register();},register:function(){},render:function(){},parseEvents:function(){var e=this.events||{};for(var c in e){for(var d in e[c]){var f=this[e[c][d]]||e[c][d];a.delegate(this.container,c,d,a.bind(f,this));}}},getDictionary:function(){return a.LanguageManager.getInstance().dictionary;}});a.View=b;}(TRACKS));(function(b){var a=b.View.extend({map:null,zoom:15,centerMarker:null,markers:[],clusterOptions:{gridSize:50,maxZoom:15,styles:[{url:"assets/images/cluster45x45.png",height:45,width:45,anchor:(b.ie()>8)?[17,0]:[16,0],textColor:"#197EBA",textSize:11},{url:"assets/images/cluster70x70.png",height:70,width:70,anchor:(b.ie()>8)?[29,0]:[28,0],textColor:"#197EBA",textSize:11},{url:"assets/images/cluster90x90.png",height:90,width:90,anchor:[41,0],textColor:"#197EBA",textSize:11}]},events:{},init:function(c){this._parent(c);this.startZoom=c.startZoom||7;this.startLocation=c.startLocation||{lat:46.08371401022221,lon:23.73289867187499};this.sendAnalytics=c.sendAnalytics;this.mapReady=c.mapReady;if(this.mapReady){b.bind(this.mapReady,this);}if(this.sendAnalytics){b.bind(this.sendAnalytics,this);}},register:function(){this.onMessage("setCenter",this.onSetCenter);this.onMessage("setCenterMarker",this.setCenterMarker);this.onMessage("setZoom",this.onSetZoom);this.onMessage("fitMapToBounds",this.onFitMapToBounds);this.onMessage("showData",this.onShowData);this.onMessage("stateChanged",this.onStateChanged);this.onMessage("showDataItemTooltip",this.onShowDataItemTooltip);this.onMessage("selectDataItemOnMap",this.onSelectDataItem);this.onMessage("showElevationMarker",this.onShowElevationMarker);this.onMessage("hideElevationMarker",this.onHideElevationMarker);this.onMessage("panBy",this.onPanBy);this.onMessage("emptySearch",this.onEmptySearch);},render:function(){var c={zoom:this.startZoom,center:new google.maps.LatLng(this.startLocation.lat,this.startLocation.lon),mapTypeId:google.maps.MapTypeId.HYBRID,mapTypeControl:true,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DEFAULT,position:google.maps.ControlPosition.TOP_RIGHT},panControl:false,zoomControl:false,streetViewControl:false,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL}};this.map=new google.maps.Map(this.renderContainer,c);var d=google.maps.event.addListener(this.map,"tilesloaded",b.bind(function(e){this.dataManager.getDataFromDataSource();this.sendMessage("mapReady");if(this.mapReady){this.mapReady.call(this,[]);}google.maps.event.removeListener(d);},this));google.maps.event.addListener(this.map,"idle",b.bind(function(e){if(this.app.state===b.App.States.INFO){b.unmask(b.MASK_ELEMENT);}},this));return this;},setZoom:function(c){if(!c){return;}this.map.setZoom(c);},setCenter:function(d){if(!d||!d.lat||!d.lon){return;}var c=new google.maps.LatLng(d.lat,d.lon);this.setCenterMarker(d);this.map.setCenter(c);},setCenterMarker:function(d){if(!d||!d.lat||!d.lon){return;}var c=new google.maps.LatLng(d.lat,d.lon);if(this.centerMarker){this.centerMarker.setMap(this.map);this.centerMarker.setPosition(c);}else{this.centerMarker=this.createMarker({icon:"assets/images/target-icon.png",position:{lat:d.lat,lon:d.lon}});}},createMarker:function(d){var e=d.hideMarker?null:this.map,c=(d.position&&(!d.position.lat||!d.position.lon))?d.position:new google.maps.LatLng(d.position.lat,d.position.lon);return new google.maps.Marker({map:e,icon:d.icon,position:c});},addData:function(f){var c,e=null;for(var d=0;d<f.length;d++){c=this.createMarker({icon:f[d].startMarkerUrl,position:f[d].point?f[d].point:f[d].getStartTrackPoint()});c.data=f[d];f[d].startMarker=c;if(f[d] instanceof b.Track){e=this.createMarker({icon:f[d].endMarkerUrl,position:f[d].getEndTrackPoint(),hideMarker:true});e.data=f[d];f[d].endMarker=e;}this.addMarkerListeners(c);this.markers.push(c);if(e){this.markers.push(e);}}},removeData:function(){for(var c=0;c<this.markers.length;c++){if(this.markers[c].data.mapTrack){this.markers[c].data.mapTrack.setMap(null);}this.markers[c].setMap(null);}this.removeTooltip();},addMarkerListeners:function(c){google.maps.event.addListener(c,"click",b.bind(function(){this.onMarkerClick(c);},this));google.maps.event.addListener(c,"mouseover",b.bind(function(d){if(this.app.state==b.App.States.INFO||this.app.state==b.App.States.SHARE){return;}this.onMarkerOver(c);},this));google.maps.event.addListener(c,"mouseout",b.bind(function(d){if(this.app.state==b.App.States.INFO||this.app.state==b.App.States.SHARE){return;}this.removeTooltip();},this));},selectDataItem:function(c){if(!c){return;}this.deselectData(this.lastData);if(this.lastData&&this.lastData.id==c.id){if(this.app.state===b.App.States.SHARE&&this.tooltip){this.removeTooltip();this.lastData=null;return;}else{if(this.app.state!==b.App.States.SHARE){this.removeTooltip();this.lastData=null;return;}}}b.setUrlHash(c.id);b.mask(b.MASK_ELEMENT);this.lastData=c;if(this.app.state===b.App.States.SHARE){this.addData([c]);}this.showTooltip(c.startMarker,true);if(c instanceof b.Track){c.mapTrack.setMap(this.map);this.map.fitBounds(c.bounds);this.lastData.endMarker.setMap(this.map);this.sendMessage("showElevationProfile",c);}else{this.sendMessage("hideElevationProfile",c);}if(this.app.state!==b.App.States.SHARE){this.sendMessage("changeState",{state:b.App.States.INFO});}b.unmask(b.MASK_ELEMENT);},deselectData:function(c){if(!c){return;}b.setUrlHash("");if(this.lastData.endMarker){this.lastData.endMarker.setMap(null);c.mapTrack.setMap(null);this.sendMessage("reverseState");}},showTooltip:function(c,d){var e=null,f=null,g=d?"../../assets/images/close.png":"";this.removeTooltip();if(c.data instanceof b.Track){e=this.mustache(this.templates.trackTooltipTemplate,{data:c.data,fullDetails:d,language:this.getDictionary()});f=d?new google.maps.Size(-136,-145):new google.maps.Size(-136,-125);}else{e=this.mustache(this.templates.poiTooltipTemplate,{data:c.data,fullDetails:d,language:this.getDictionary()});f=new google.maps.Size(-136,-120);}this.tooltip=new InfoBox({content:e,closeBoxURL:g,closeBoxMargin:"5px 5px 0px 0px",pixelOffset:f});
google.maps.event.addListener(this.tooltip,"closeclick",b.bind(function(){this.tooltip=null;},this));this.tooltip.open(this.map,c);},removeTooltip:function(){if(this.tooltip){this.tooltip.close();this.tooltip=null;}},onUserGeocoded:function(d){var c=[];if(!d||!d.lat||!d.lon){return;}if(this.dataManager.poiFilterActive&&this.dataManager.trackFilterActive){c=this.geoOperations.getDataInBounds(this.dataManager.tracks.concat(this.dataManager.pois),d,this.app.views[0].searchRadius);}else{if(this.dataManager.trackFilterActive){c=this.geoOperations.getDataInBounds(this.dataManager.tracks,d,this.app.views[0].searchRadius);}else{if(this.dataManager.poiFilterActive){c=this.geoOperations.getDataInBounds(this.dataManager.pois,d,this.app.views[0].searchRadius);}}}if(c.length>0){this.setCenterMarker(d);return;}else{this.setCenter(d);this.setZoom(this.zoom);}},onShowData:function(e){var d=null;b.mask(b.MASK_ELEMENT);if(this.dataManager.poiFilterActive&&this.dataManager.trackFilterActive){var c=this.dataManager.tracks.length+this.dataManager.pois.length;if(e.length===c){this.lastData=null;}}else{if(this.dataManager.trackFilterActive){if(e.length===this.dataManager.tracks.length){this.lastData=null;}}else{if(this.dataManager.poiFilterActive){if(e.length===this.dataManager.pois.length){this.lastData=null;}}}}this.removeData();this.addData(e);if(this.app.state==b.App.States.SEARCH||this.app.state==b.App.States.DEFAULT){d=this.geoOperations.getDataBounds(e);if(this.dataManager.geocodedLocation){d.extend(new google.maps.LatLng(this.dataManager.geocodedLocation.lat,this.dataManager.geocodedLocation.lon));}this.map.fitBounds(d);}b.unmask(b.MASK_ELEMENT);},onFitMapToBounds:function(c){this.map.fitBounds(c);},onSetCenter:function(c){this.setCenter(c);},onSetZoom:function(c){this.setZoom(c);},onStateChanged:function(c){if(c.currentState==b.App.States.INFO){}if(c.lastState==b.App.States.INFO){}},onShowDataItemTooltip:function(c){this.onMarkerOver(c.startMarker);},onSelectDataItem:function(c){this.selectDataItem(c);},onShowElevationMarker:function(c){if(!c||!c.position){return;}if(this.elevationMarker){this.elevationMarker.setMap(null);}this.elevationMarker=this.createMarker(c);},onHideElevationMarker:function(){if(this.elevationMarker){this.elevationMarker.setMap(null);}},onPanBy:function(c){if(!c){return;}this.map.panBy(c.x,c.y);},onEmptySearch:function(){if(this.centerMarker){this.centerMarker.setMap(null);}},onMarkerClick:function(c){if(this.app.state===b.App.States.SHARE){if(this.tooltip){this.removeTooltip();}else{this.showTooltip(c.data.startMarker,true);}}else{this.selectDataItem(c.data);this.sendMessage("selectDataItemInList",c.data);}this.sendAnalytics("Marker clicked","Name: "+c.data.name+" | URL: "+c.data.url);},onMarkerOver:function(c){if(this.app.state==b.App.States.INFO){return;}this.showTooltip(c,false);}});b.MapView=a;}(TRACKS));(function(a){var b="#search-input";var c=a.View.extend({events:{"#search img":{click:"onSearchIconClick"},"#search-input":{keyup:"onKeyUp"},"#suggestions a":{click:"onSuggestionClick"}},init:function(d){this._parent(d);this.searchRadius=d.searchRadius||100;this.countryCode=d.countryCode;this.sendAnalytics=d.sendAnalytics;if(this.sendAnalytics){a.bind(this.sendAnalytics,this);}this.dataManager.on("userGeocoded",a.bind(this.onUserGeocoded,this));this.dataManager.on("userNotGeocoded",a.bind(this.onUserNotGeocoded,this));},register:function(){this.onMessage("openSearch",this.onOpenSearch);this.onMessage("closeSearch",this.onCloseSearch);this.onMessage("emptySearch",this.onEmptySearch);this.onMessage("stateChanged",this.onStateChanged);},render:function(){this.container.innerHTML=this.mustache(this.templates.main,{language:this.getDictionary()});this.toggle();return this;},focus:function(){a.one(b,this.container).focus();},searchLocationData:function(d){this.searchInputText=d||this.getInputValue();if(!this.searchInputText){return;}this.dataManager.geocode(this.searchInputText,this.countryCode,true,{success:a.bind(function(g){if(g.length==0){return;}var e=[];for(var f=0;f<3;f++){if(g[f]){e.push(g[f]);}}this.addSuggestions(e);},this)});},search:function(d){this.sendMessage("changeState",{state:a.App.States.SEARCH});var e=this.dataManager.search(d,this.searchRadius);if(e&&e.length>0){this.sendMessage("setCenterMarker",d);}else{this.sendMessage("setCenter",d);this.sendMessage("fitMapToBounds",new google.maps.LatLngBounds(new google.maps.LatLng(d.bounds[0],d.bounds[1]),new google.maps.LatLng(d.bounds[2],d.bounds[3])));}this.sendMessage("showData",e);if(this.dataManager.poiFilterActive&&this.dataManager.trackFilterActiveFilterActive){this.sendAnalytics("POIs & Tracks near - "+d.address,tracksInBounds.length);}else{if(this.dataManager.poiFilterActive){this.sendAnalytics("POIs near - "+d.address,e.length);}else{if(this.dataManager.trackFilterActiveFilterActive){this.sendAnalytics("Tracks near - "+d.address,e.length);}}}},addSuggestions:function(d){if(!d||d.length==0){return;}this.sendMessage("closeList");this.sendMessage("closeFilters");this.suggestions=d;var e=a.one("#suggestions",this.container);e.innerHTML=this.mustache(this.templates.suggestions,{suggestions:d,language:this.getDictionary()});a.css(e,"display","block");},removeSuggestions:function(){var d=a.one("#suggestions",this.container);d.innerHTML="";a.css(d,"display","none");this.suggestions=[];},setInputValue:function(d){a.one(b,this.container).value=d;},getInputValue:function(){return a.one(b,this.container).value;},isOpen:function(){return jQuery("#search input").css("left")=="0px"?true:false;},toggle:function(){if(this.isOpen()){this.close();}else{this.open();this.focus();}},open:function(){if(this.isOpen()){return;}jQuery("#search input").animate({left:0},200,null);jQuery("#search img").animate({left:"290px"},200,null);},close:function(){if(!this.isOpen()){return;}this.removeSuggestions();jQuery("#search input").animate({left:"-=290px"},200,null);jQuery("#search img").animate({left:0},200,null);},onSearchIconClick:function(d){this.toggle();
},onKeyUp:function(d){var e=this.getInputValue();if(e.length>2){this.searchLocationData();}},onSuggestionClick:function(d){var f=d.target.id.split("-")[1];var e=this.suggestions[f];this.dataManager.geocodedLocation=e;this.setInputValue(e.address);this.removeSuggestions();this.search(e);this.sendMessage("setCenterMarker",e);this.sendMessage("changeState",{state:a.App.States.SEARCH});},onUserGeocoded:function(d){if(!d||!d.address){return;}this.setInputValue(d.address);this.search(d);this.open();},onUserNotGeocoded:function(){var d=this.dataManager.search();this.removeSuggestions();this.sendMessage("showData",d);this.sendMessage("changeState",{state:a.App.States.DEFAULT});},onOpenSearch:function(){this.open();this.focus();this.setInputValue("");},onCloseSearch:function(){this.close();},onStateChanged:function(d){if(d.currentState===a.App.States.INFO){this.close();}},onEmptySearch:function(){this.setInputValue("");this.dataManager.location=null;}});a.SearchView=c;}(TRACKS));(function(b){var a=b.View.extend({selectedDataId:-1,events:{"#list #list-toggle":{click:"onListToggleClick"},"#list #article":{click:"onLinksClick"},"#list #download":{click:"onLinksClick"},"#list .data":{click:"onDataItemClick",hover:"onDataItemHover"},"#list #search":{click:"onOpenSearch"},"#list #all-data":{click:"onShowAllData"}},init:function(c){this._parent(c);this.noTracksMsg=c.noTracksMsg?c.noTracksMsg:"No data found!";this.onReady=c.onReady;this.sendAnalytics=c.sendAnalytics;if(this.sendAnalytics){b.bind(this.sendAnalytics,this);}if(this.onReady){b.bind(this.onReady,this);}},register:function(){this.onMessage("showData",this.onShowData);this.onMessage("closeList",this.onCloseList);this.onMessage("selectDataItemInList",this.onSelectDataItem);this.onMessage("stateChanged",this.onStateChanged);this.onMessage("emptySearch",this.onEmptySearch);},render:function(){if(!this.data||this.data.length==0){this.container.innerHTML=this.mustache(this.templates.empty,{language:this.getDictionary()});}else{this.container.innerHTML=this.mustache(this.templates.main,{data:this.data,language:this.getDictionary()});}if(this.onReady){this.onReady();}return this;},toggleList:function(){var c=jQuery("#list").css("left")=="0px"?true:false;if(c){this.close();}else{this.open();}},toggleDataDetails:function(c){if(c===-1){return;}if(jQuery("#list #"+c+" #data-parameters").css("display")==="none"){jQuery("#list #"+c+" #preview").css("width","80px");jQuery("#list #"+c+" #preview").css("height","auto");}else{jQuery("#list #"+c+" #preview").css("width","60px");jQuery("#list #"+c+" #preview").css("height","30px");}jQuery("#list #"+c+" #data-parameters").toggle("fast");},open:function(){var c=jQuery("#list").css("left")=="0px"?true:false;if(!c){jQuery("#list").animate({left:0},200,null);if(this.app.state===b.App.States.INFO){this.sendMessage("panBy",{x:-150,y:0});}}},close:function(){var c=jQuery("#list").css("left")=="0px"?true:false;if(c){jQuery("#list").animate({left:"-330px"},200,null);if(this.app.state===b.App.States.INFO){this.sendMessage("panBy",{x:150,y:0});}}},selectDataItem:function(d){if(d!==this.selectedDataId){b.setUrlHash(d);this.toggleDataDetails(this.selectedDataId);this.toggleDataDetails(d);this.selectedDataId=d;jQuery("#list #data").mCustomScrollbar("scrollTo","#"+d);var c=this.dataManager.getDataById(d);this.sendAnalytics("Track Selected","Name: "+c.name+" | URL: "+c.url);}else{b.setUrlHash("");this.toggleDataDetails(d);this.selectedDataId=-1;}},onListToggleClick:function(){this.toggleList();},onDataItemClick:function(d){var e=d.currentTarget.id,c=this.dataManager.getDataById(e);this.selectDataItem(e);this.sendMessage("selectDataItemOnMap",c);},onDataItemHover:function(c){var e=c.currentTarget.id,d=this.dataManager.getDataById(e);if(this.app.views[1].map.getZoom()<9){this.sendMessage("showDataItemTooltip",d);}},onShowData:function(c){this.data=c;this.render();this.open();},onSelectDataItem:function(c){if(!c){return;}this.selectDataItem(c.id);},onCloseList:function(){this.close();},onLinksClick:function(c){c.stopPropagation();},onStateChanged:function(c){if(c.currentState===b.App.States.INFO){this.sendMessage("panBy",{x:-150,y:0});}},onOpenSearch:function(){this.sendMessage("openSearch");this.close();},onEmptySearch:function(){b.setUrlHash("");this.selectedDataId=-1;},onShowAllData:function(){b.setUrlHash("");jQuery("#filters #filter-items #pois-and-tracks").prop("checked",true);this.dataManager.poiFilterActive=true;this.dataManager.trackFilterActive=true;this.sendMessage("changeState",{state:b.App.States.DEFAULT});this.sendMessage("emptySearch");this.sendMessage("showData",this.dataManager.search());this.sendAnalytics("Show all data","Show all data");},});b.ListView=a;}(TRACKS));(function(a){var b=a.View.extend({events:{"#elvation-profile-toggle":{click:"onElevationProfileClick"}},init:function(c){this._parent(c);this.xAxisName=c.xAxisName?c.xAxisName:"Distance (km)";this.yAxisName=c.yAxisName?c.yAxisName:"Altitude (m)";},register:function(){this.onMessage("showElevationProfile",this.onShowElevationProfile);this.onMessage("hideElevationProfile",this.onHideElevationProfile);},render:function(c){if(!c||!c.hasElevationProfile()){return;}var e=this.generateElevationProfileData(c);var d={width:700,height:140,hAxis:{title:this.xAxisName,titleTextStyle:{color:"#333"}},vAxis:{title:this.yAxisName,minValue:e.minElevation,titleTextStyle:{color:"#333"}},legend:"none"};this.elevationProfileChart=new google.visualization.AreaChart(this.renderContainer);this.elevationProfileChart.draw(e,d);google.visualization.events.addListener(this.elevationProfileChart,"onmouseover",a.bind(this.onElevationProfileOver,this));google.visualization.events.addListener(this.elevationProfileChart,"onmouseout",a.bind(this.onElevationProfileOut,this));if(this.app.state===a.App.States.SHARE){this.app.showView(this);}this.open();},generateElevationProfileData:function(c){var g=new google.visualization.DataTable(),e=parseInt(c.elevationPoints[0]),f=null;g.addColumn("number",this.xAxisName);
g.addColumn("number",this.yAxisName);for(var d=0;d<c.elevationPoints.length;d++){f=parseInt(c.elevationPoints[d]);g.addRow([c.getDistanceFromStart(d),f]);if(f<e){e=f;}}g.minElevation=e;return g;},toggle:function(){var c=jQuery("#elevation-profile").css("bottom")=="0px"?true:false;if(c){this.close();}else{this.open();}},open:function(){var c=jQuery("#elevation-profile").css("bottom")=="0px"?true:false;if(!c){this.sendMessage("panBy",{x:0,y:130});jQuery("#elevation-profile").animate({bottom:0},200,null);}},close:function(){var c=jQuery("#elevation-profile").css("bottom")=="0px"?true:false;if(c){this.sendMessage("panBy",{x:0,y:-130});jQuery("#elevation-profile").animate({bottom:"-140px"},200,null);}},onElevationProfileClick:function(){if(!this.track||!this.track.hasElevationProfile()){return;}this.toggle();},onElevationProfileOver:function(c){this.sendMessage("showElevationMarker",{icon:"assets/images/marker-small.png",position:{lat:this.track.points[c.row].lat(),lon:this.track.points[c.row].lng()}});},onElevationProfileOut:function(){this.sendMessage("hideElevationMarker");},onShowElevationProfile:function(c){if(!c){return;}jQuery(this.container).css("display","block");this.track=c;this.render(c);},onHideElevationProfile:function(){jQuery(this.container).css("display","none");}});a.ElevationProfileView=b;}(TRACKS));(function(a){var b=a.View.extend({events:{"#filters #filter-toggle":{click:"onFilterIconClick"},"#filters #filter-items input":{click:"onFilterClick"},"#filters #all-data":{click:"onShowAllData"}},init:function(c){this._parent(c);this.sendAnalytics=c.sendAnalytics;if(this.sendAnalytics){a.bind(this.sendAnalytics,this);}},register:function(){this.onMessage("closeFilters",this.onCloseFilters);},render:function(){this.container.innerHTML=this.mustache(this.templates.main,{language:this.getDictionary()});return this;},isOpen:function(){return jQuery("#filters #filter-items").css("left")=="0px"?true:false;},toggle:function(){if(this.isOpen()){this.close();}else{this.open();}},open:function(){if(this.isOpen()){return;}jQuery("#filters #filter-items").animate({left:0},200,null);jQuery("#filters img").animate({left:"290px"},200,null);},close:function(){if(!this.isOpen()){return;}jQuery("#filters #filter-items").animate({left:"-=290px"},200,null);jQuery("#filters img").animate({left:0},200,null);},onFilterIconClick:function(){this.toggle();},onFilterClick:function(c){if(jQuery("#filters #filter-items #pois").is(":checked")){this.dataManager.poiFilterActive=true;this.dataManager.trackFilterActive=false;this.sendAnalytics("Filter selected","POI");}if(jQuery("#filters #filter-items #tracks").is(":checked")){this.dataManager.poiFilterActive=false;this.dataManager.trackFilterActive=true;this.sendAnalytics("Filter selected","Tracks");}if(jQuery("#filters #filter-items #pois-and-tracks").is(":checked")){this.dataManager.poiFilterActive=true;this.dataManager.trackFilterActive=true;this.sendAnalytics("Filter selected","POI + Tracks");}var d=this.dataManager.search();this.sendMessage("showData",d);},onShowAllData:function(){jQuery("#filters #filter-items #pois-and-tracks").prop("checked",true);this.dataManager.poiFilterActive=true;this.dataManager.trackFilterActive=true;this.sendMessage("changeState",{state:a.App.States.DEFAULT});this.sendMessage("emptySearch");this.sendMessage("showData",this.dataManager.search());this.sendAnalytics("Show all data","Show all data");},onCloseFilters:function(){this.close();},});a.FiltersView=b;}(TRACKS));(function(a){var b=a.MsgManager.extend({views:[],state:null,lastState:null,init:function(c){this._parent();this.language=c.language;this.state=c.state;this.language=c.language;this.addViews(c.views||[]);this.appReady=c.appReady;this.register();a.DataManager.getInstance().app=this;},addView:function(c){if(!c){return;}c.app=this;if(this.views.indexOf(c)==-1){this.views.push(c);}},addViews:function(c){for(var d=0;d<c.length;d++){this.addView(c[d]);}},removeView:function(c){},register:function(){this.onMessage("changeState",this.onChangeState);this.onMessage("reverseState",this.onReverseState);},start:function(){if(this.language){a.LanguageManager.getInstance().loadLanguage(this.language,a.bind(function(){this._start();},this));}else{this._start();}},_start:function(){for(var c=0;c<this.views.length;c++){this.views[c].render();}this.changeState(this.state||"home");if(this.appReady){this.appReady.call(this,[]);}},changeState:function(e,f){if(e==this.state&&this.lastState!=null){return;}this.lastState=this.state;this.state=e;for(var d=0;d<this.views.length;d++){var c=this.views[d];if(c.hideOnStates.indexOf(this.state)!=-1){this.hideView(c);}else{this.showView(c);}}this.sendMessage("stateChanged",{currentState:this.state,lastState:this.lastState});},hideView:function(c){a.addClass(c.container,"hide-view");this.sendMessage("hideView",c.container);},showView:function(c){a.removeClass(c.container,"hide-view");this.sendMessage("showView",c.container);},onChangeState:function(c){this.changeState(c.state);},onReverseState:function(c){this.changeState(this.lastState);}});a.App=b;a.MASK_ELEMENT=".romtrack";a.MASK_MESSAGE="Lucr�?m :)";a.App.States={};a.App.States.DEFAULT="default";a.App.States.SEARCH="search";a.App.States.INFO="trackinfo";a.App.States.SHARE="share";}(TRACKS));