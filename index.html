<!DOCTYPE html>
<html>
	<head>
		<title>Tracks</title>
		
		<!-- Icon -->
		<link rel="icon" href="images/favicon.ico" />
		
		<!-- Style -->
		<link rel="stylesheet" type="text/css" href="style/main.css">
	    <link rel="stylesheet" type="text/css" href="style/grids-min.css">
	    <link rel="stylesheet" type="text/css" href="style/cssreset-min.css">
        <link rel="stylesheet" href="style/jquery.mCustomScrollbar.min.css" />
        <link rel="stylesheet" type="text/css" href="style/jquery.loadmask.css"/>

	    
	    <!-- Google Maps -->
<!--    	<script type="text/javascript" src="http://maps.google.com/maps/api/js?v=3.3&sensor=false&language=en"></script>-->
        <script type="text/javascript" src="http://maps.google.com/maps/api/js?libraries=geometry&sensor=true"></script>
        <script type="text/javascript" src="https://www.google.com/jsapi"></script>
        
        <!-- Google Analytics -->
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-54715600-1', {
              'cookieDomain': 'apphb.com',
              'allowlinker': true
            });
            ga('send', 'pageview');
        </script>
	    
	    <script type="text/javascript" src="libs/jquery-1.7.2.min.js"></script>
	    <script type="text/javascript" src="libs/js.class.js"></script>
		<script type="text/javascript" src="libs/romtracks.jquery-min.js"></script>
		<script type="text/javascript" src="libs/romtracks.js"></script>
		<script type="text/javascript" src="libs/mustache.js"></script>
		<script type="text/javascript" src="libs/jsonp.js"></script>
		<script type="text/javascript" src="libs/romtracks.helpers.js"></script>
        <script type="text/javascript" src="libs/infobox.js"></script>
        <script type="text/javascript" src="libs/markerclusterer.js"></script>
        <script type="text/javascript" src="libs/d3.js"></script>
        <script type="text/javascript" src="libs/jquery.mCustomScrollbar.concat.min.js"></script>
        <script type="text/javascript" src="libs/jquery.loadmask.js"></script>
	    
		<!-- Font -->
	    <link href='http://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
		
		<!-- Script -->
		<script>
	
			(function( $j )
			{
                google.load("visualization", "1", {packages:["corechart"]});
				
                $j(document).ready( function(){
                    
					/** App **/
					var app = new TRACKS.App({
						state: TRACKS.App.States.SEARCH,
						views: [
							/*
							 * Search View
							 */
							new TRACKS.SearchView({
                                searchRadius: 40,
                                countryCode: "ro",
								container: TRACKS.one("#search"),
								hideOnStates: [],
								templates: {
									main: $j.trim( TRACKS.one("#search-tpl").innerHTML ),
                                    suggestions: $j.trim( TRACKS.one("#suggestions-tpl").innerHTML )
								},
                                sendAnalytics: function (action, label) {
                                    if (!action || !label) {
                                        return;
                                    }
                                    
                                    ga('send', 'event', 'Search', action, label);
                                }
							}),
							/*
							 * Map View
							 */
							new TRACKS.MapView({
								container: TRACKS.one("#map"),
								renderContainer: TRACKS.one("#map"),
								hideOnStates: [],
								zoom: 3,
								templates: {
                                    tooltipTemplate: $j.trim( TRACKS.one("#tooltip-tpl").innerHTML )
								},
                                sendAnalytics: function (action, label) {
                                    if (!action || !label) {
                                        return;
                                    }
                                    
                                    ga('send', 'event', 'Map', action, label);
                                }	
							}),
                            /*
							 * List View
							 */
							new TRACKS.ListView({
								container: TRACKS.one("#list"),
								renderContainer: TRACKS.one("#list #container"),
								hideOnStates: [],
                                noTracksMsg: "Din păcate nu am găsit nimic în jurul locației căutate :(",
								templates: {
                                    main: $j.trim( TRACKS.one("#list-tpl").innerHTML ),
                                    empty: $j.trim( TRACKS.one("#empty-list-tpl").innerHTML )
								},
                                onReady: function () {
                                    $j("#list #data").mCustomScrollbar({
                                        theme: "minimal-dark"
                                    });
                                },
                                sendAnalytics: function (action, label) {
                                    if (!action || !label) {
                                        return;
                                    }
                                    
                                    ga('send', 'event', 'List', action, label);
                                }
							}),
                            /*
							 * Elevation Profile view
							 */
							new TRACKS.ElevationProfileView({
								container: TRACKS.one("#elevation-profile"),
								renderContainer: TRACKS.one("#elevation-profile #container"),
								hideOnStates: [TRACKS.App.States.DEFAULT, TRACKS.App.States.SEARCH],
                                xAxisName: "Distanță (km)",
                                yAxisName: "Altitudine (m)",
								templates: {
                                    main: $j.trim( TRACKS.one("#elevation-profile-tpl").innerHTML )
								}	
							}),
                            /*
							 * Filter view
							 */
                            new TRACKS.FiltersView({
                                container: TRACKS.one("#filters"),
                                renderContainer: TRACKS.one("#filters #container"),
                                hideOnStates: [],
                                templates: {
                                    main: $j.trim( TRACKS.one("#filters-tpl").innerHTML )
                                }	
                            })
						],
                        appReady: function () {
                            TRACKS.poisLoaded = false;
                            TRACKS.tracksLoaded = false;
                            
                            TRACKS.dispatcher.onMessage("poisLoaded", function () {
                                TRACKS.poisLoaded = true;
                                
                                if (TRACKS.tracksLoaded) {
                                    //GeolocateUser
                                    TRACKS.DataManager.getInstance().geolocateUser();
                                }
                            });
                            
                            TRACKS.dispatcher.onMessage("tracksLoaded", function () {
                                TRACKS.tracksLoaded = true;

                                if (TRACKS.poisLoaded) {
                                    //GeolocateUser
                                    TRACKS.DataManager.getInstance().geolocateUser();
                                }
                            });
                        }
					});
	
					app.start();
		            TRACKS.mask(TRACKS.MASK_ELEMENT);
				});
				
			})(jQuery.noConflict());
			
		</script>	
		
	</head>
	<body>

        <div class="romtrack">
            <div id="search"></div>
            <div id="filters">
                <div id="container"></div>
            </div>
            <div id="list">
                <div id="container"></div>
            </div>
            <div id="elevation-profile">
                <div id="content">
                    <img id="elvation-profile-toggle"  src="assets/images/chart.png" width="30px" />
                    <div id="container"></div>
                </div>
            </div>
            <div id="map"></div>
		</div>
		<!-- Templates -->
		
		<!-- Search View template -->
		<script id="search-tpl" type="text/template">
            <img src="assets/images/red-search-icon.png" />
			<input id="search-input" class="yui3-u" type="text" placeholder="Caută trasee în jurul unei locații..."/>
            <div id="suggestions"></div>
		</script>
        
        <!-- Search View suggestions template -->
        <script id="suggestions-tpl" type="text/template">
            {{#suggestions}}
                <div class="item">
                    <a id="addr-{{index}}" href="#">{{address}}</a>
                    <div class="separator"></div>
                </div>
            {{/suggestions}}
	   </script>
        
        <!-- Tooltip template -->
        <script id="tooltip-tpl" type="text/template">
            <div class="infoWindow yui3-g">
                <img class="yui3-u" src={{data.preview}} width="50px" height="50px"/>
                <div id="details" class="yui3-u">
                    <div id="name">{{data.name}}</div>
                    {{#data.length}}<div id="length"><b>Lungime:</b> {{data.length}} km</div>{{/data.length}}
                    {{#data.ascent}}<div id="ascent"><b>Urcare:</b> {{data.ascent}} m</div>{{/data.ascent}}
                    {{#data.descent}}<div id="descent"><b>Coborâre:</b> {{data.descent}} m</div>{{/data.descent}}
                    {{#fullDetails}}
                        {{#data.article}}<div id="article"><a href={{data.article}} target="_blank">Citește articolul</a></div>{{/data.article}}
                        {{#data.url}}<div id="download"><a href={{data.url}} target="_blank">Descarcă traseul (GPX)</a></div>{{/data.url}}
                    {{/fullDetails}}
                </div>
            </div>
            <div class="tail"></div>
		</script>
        
        <!-- List template -->
        <script id="list-tpl" type="text/template">
            <div id="header" class="yui3-g">
                <img id="all-data" width="16px" title="Arată tot" src="assets/images/refresh.png" />
            </div>
            <img id="list-toggle" src="assets/images/list.png" width="30px"/>
            <div id="data">
                {{#data}}
                    <div id="dataitem-{{index}}" class="yui3-g data">
                        <div class="yui3-u">
                            <img id="preview" src={{preview}} width="60px" height="30px"/>    
                        </div>
                        <div class="yui3-u info">
                            <div id="name">{{name}}</div>
                            <div id="data-parameters" style="display: none">
                                {{#length}}<div id="length"><b>Lungime:</b> {{length}} km</div>{{/length}}
                                {{#ascent}}<div id="ascent"><b>Urcare:</b> {{ascent}} m</div>{{/ascent}}
                                {{#descent}}<div id="descent"><b>Coborâre:</b> {{descent}} m</div>{{/descent}}
                                {{#article}}<div id="article"><a href={{article}} target="_blank">Citește articolul</a></div>{{/article}}
                                {{#url}}<div id="download"><a href={{url}} target="_blank">Descarcă traseul (GPX)</a></div>{{/url}}
                            </div>
                        </div>
                    </div>
                {{/data}}
            </div>
		</script>
        
        <!-- Filter template -->
        <script id="filters-tpl" type="text/template">
            <img src="assets/images/filter.png" />
            <div id="checkboxes" class="yui3-g">
                <div class="filter-item yui3-u">
                    <input id="pois" name="geographic-data" type="radio"><img class="filter-marker" src="assets/images/poi-marker.png" width="20px"/>Locuri
                </div>
                <div class="filter-item yui3-u">
                    <input id="tracks" name="geographic-data" type="radio"><img class="filter-marker" src="assets/images/marker.png" width="20px"/>Trasee
                </div>   
                <div class="filter-item yui3-u">
                    <input id="pois-and-tracks" name="geographic-data" type="radio" checked>Locuri & Trasee
                </div>
            </div>
        </script>
        
        <script id="empty-list-tpl" type="text/template">
            <img id="list-toggle" src="assets/images/list.png" width="30px"/>
            {{#message}}
                <div id="message">{{message}}</div>
                <div id="actions">
                    <span id="search" class="link">Căutați în altă locație</span> sau <span id="all-data" class="link">vedeți toate datele.</span>
                </div>
            {{/message}}
		</script>
		
        <!-- Elevation profile template -->
        <script id="elevation-profile-tpl" type="text/template">
            
		</script>
	</body>
</html>